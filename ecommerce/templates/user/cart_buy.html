<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout</title>
    <!-- <link rel="stylesheet" href="path_to_your_css_file.css"> -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    {% load static %}
</head>
<style>
    .os2{
      padding-top: 20px;
  }
  .os2 .col-lg-8 .row2{
      padding: 20px;
      height: 200px;
      border: 1px solid;
      border-radius: 10px;
  }
  .os2 .col-lg-8 .row img{
      border-radius: 5px;
      width: 200px;
      height: 150px;
  }
  .os2 .col-lg-8 h3{
      font-size: 20px;
  }
  .os2 .col-lg-8 .row3{
      margin: 0;
      padding: 0;
  }
  .os2 .col-lg-8 .row3 .col-xs-6{
      padding: 0;
  }
  .os2 .name{
      font-weight: 700;
      color: rgb(77, 76, 75);
  }
  .os2 a{
      text-decoration: none;
      color: black;
  }
  .os2 .col-lg-4 #address{
      width: 350px;
      height: 50px;
  }
  .os2 .row4{
      margin-top: 20px;
  }
  .os2 .row4 .col-lg-6 h3{
      font-size: 18px;
  }
  .pay .btn{
      background-color: orange;
      color: white;
  }
  .os{
      padding-top: 20px;
  }
  .os img{
      width: 300px;
      height: 280px;
      border-radius: 5px;
      display:block;
      margin:auto;
  }
  .os a{
      text-decoration: none;
      color: black;
  }
  .os .name{
      font-weight: 700;
      color: rgb(77, 76, 75);
  }
  .os .row2{
      margin-top: 20px;
  }
  .os .row2 .col-lg-6 h3{
      font-size: 20px;
  }
  .os .btn,.address .btn1,.addressForm .btn{
      border-color: orange;
      color: orange;
  
  }
  .os .btn,.address .btn1 , .addressForm .btn:hover{
      background-color: orange;
      color: white;
  }
  </style>
<body>
    <div class="container">
        <h2>Proceed to Checkout</h2>
        
        <!-- <div class="cart-items">
            {% for item in cart_items %}
            <div class="cart-item">
                <img src="{{ item.Plants.img.url }}" alt="{{ item.Plants.name }}">
                <div class="item-details">
                    <h4>{{ item.Plants.name }}</h4>
                    <p class="price">${{ item.Plants.offer_price }}</p>
                    <p>Quantity: {{ item.qty }}</p>
                </div>
            </div>
            {% endfor %}
        </div>
        
        <div class="total">
            <h4>Total: ${{ total }}</h4>
        </div>
        
        <h3>Shipping Address</h3>
        <form method="POST">
            {% csrf_token %}
            <div>
                <label for="name">Full Name:</label>
                <input type="text" id="name" name="name" required>
            </div>
            <div>
                <label for="phn">Phone Number:</label>
                <input type="text" id="phn" name="phn" required>
            </div>
            <div>
                <label for="pin">PIN Code:</label>
                <input type="text" id="pin" name="pin" required>
            </div>
            <div>
                <label for="loc">Location:</label>
                <input type="text" id="loc" name="loc" required>
            </div>
            <div>
                <label for="adrs">Address:</label>
                <textarea id="adrs" name="adrs" required></textarea>
            </div>
            <div>
                <label for="city">City:</label>
                <input type="text" id="city" name="city" required>
            </div>
            <div>
                <label for="state">State:</label>
                <input type="text" id="state" name="state" required>
            </div>
            
            <button type="submit" class="btn btn-primary">Place Order</button>
        </form>
    </div> -->






    <div class="body">
        <div class="container os2">
          <div class="row">
            <div class="col-lg-8">
              {% for i in cart %}
              <div class="row row2">
                <div class="col-lg-6">
                  <img src="{{i.Plants.img.url}}" alt="">
                  <h3>QTY : {{i.qty}}</h3>
                </div>
                <div class="col-lg-6 col-lg-61">
                  <h3 class="name">{{i.name}}</h3>
                  <div class="row row3">
                    <div class="col-lg-6 col-xs-6">
                      <h3>Price </h3>
                      <h3>Total price </h3>
                    </div>
                    <div class="col-lg-6 col-xs-6">
                      <h3 class="offerPrice">{{i.Plants.offer_price}}</h3>
                      <h3 class="totalPrice">{{i.price}}</h3>
                    </div>
                  </div>
      
                </div>
              </div>
              {% endfor %}
            </div>
            <div class="col-lg-4">
              <form class="addressForm" action="" method="post" enctype="multipart/form-data">
                {% csrf_token %}
                <label for="">Shipping address : </label><br>
                <select name="address" id="address">
                  {% for i in cart_items %}
                  <option value="{{i.pk}}">{{i.name}},{{i.house}},{{i.street}},{{i.pin}},{{i.state}}</option>
                  {% endfor %}
                </select><br>
                <a href="../adrs">Add new address + </a>
                <div class="row row4">
                  <div class="col-lg-6">
  
                    <h3>Total amount payable : </h3>
                  </div>
                  <div class="col-lg-6">
                    <!-- <h3 class="price">{{price}}</h3>
                    <h3 class="discount">{{discount}}</h3> -->
                    <h3 class="offerPrice">{{total}}</h3>
                  </div>
                </div>
                <button type="submit" class="btn">CONFIRM</button>
              </form>
            </div>
          </div>
        </div>
      </div>





      


      <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

      <script type="text/javascript">
          var options = {
              "key": "{{ razorpay_merchant_key }}", // Your Razorpay Key ID from settings
              "amount": "{{ total }}", // Amount in paise
              "currency": "INR",
              "name": "Your Shop Name",
              "description": "Purchase from your cart",
              "image": "https://example.com/your-logo.png",
              "order_id": "{{ razorpay_order_id }}", // Generated Razorpay order ID
              "handler": function (response) {
                  // On successful payment, handle the response here
                  var payment_id = response.razorpay_payment_id;
                  var order_id = response.razorpay_order_id;
                  var signature = response.razorpay_signature;
      
                  // Call your backend to verify payment and complete the order
                  var form = document.createElement("form");
                  form.method = "POST";
                  form.action = "{% url 'verify_payment' %}"; // Create a view for payment verification
                  var paymentInput = document.createElement("input");
                  paymentInput.type = "hidden";
                  paymentInput.name = "payment_id";
                  paymentInput.value = payment_id;
                  form.appendChild(paymentInput);
      
                  var orderInput = document.createElement("input");
                  orderInput.type = "hidden";
                  orderInput.name = "order_id";
                  orderInput.value = order_id;
                  form.appendChild(orderInput);
      
                  var signatureInput = document.createElement("input");
                  signatureInput.type = "hidden";
                  signatureInput.name = "razorpay_signature";
                  signatureInput.value = signature;
                  form.appendChild(signatureInput);
      
                  document.body.appendChild(form);
                  form.submit();
              },
              "prefill": {
                  "name": "{{ user.first_name }}",  // Optionally, prefill user info
                  "email": "{{ user.email }}",
                  "contact": "{{ user.phone_number }}"
              },
              "theme": {
                  "color": "#F37254"
              }
          };
      
          var rzp1 = new Razorpay(options);
          document.getElementById("confirm-btn").onclick = function (e) {
              e.preventDefault();
              rzp1.open();
          };
      </script>
      
      <!-- Add a button to trigger Razorpay -->
      <button type="button" id="confirm-btn" class="btn">CONFIRM</button>

</body>
</html>
